
## 埋点策略

埋点上报，用户量非常大，观察用户行为是否有问题时，如何处理会比较好?思路是什么？

#### 采样策略：
- 分层采样：根据用户类型分层
- 降频采样：对高频事件进行降采样，如只收集10%的页面浏览事件

#### 前端性能优化
- 批量上报
- 使用 requestIdleCallback/setTimeout：在浏览器空闲时发送，避免影响主线程
- 设置上报阈值：达到特定条件（数量/时间）再触发上报
- 压缩数据：使用 gzip/Brotli 压缩上报数据

#### 分层存储
- 热数据：最近1-7天数据存入高性能存储（如Redis）
- 温数据：7-30天数据存入列式数据库（如ClickHouse）
- 冷数据：30天以上数据归档至对象存储（如S3）

#### 可视化
- 面板实时监控、智能告警
- 分析用户行为路径

#### 常见问题与解决方案
- 数据量过大导致性能问题
    - 实现智能采样，根据用户特征动态调整采样率

- 数据延迟问题
    - 关键指标实时上报，非关键指标批量延迟上报
    - 实现离线缓存，网络恢复后再上报